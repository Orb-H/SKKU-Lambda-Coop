<html>

<head>
	<title>SKKoin Adminstrator Login page</title>
	<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

	<!-- The core Firebase JS SDK is always required and must be listed first -->
	<script defer src="/__/firebase/6.2.4/firebase-app.js"></script>

	<!-- TODO: Add SDKs for Firebase products that you want to use
	     https://firebase.google.com/docs/web/setup#reserved-urls -->
	<script defer src="/__/firebase/6.2.4/firebase-auth.js"></script>

	<!-- Initialize Firebase -->
	<script defer src="/__/firebase/init.js"></script>

	<script defer type="text/javascript">
		function signIn() {
			var id = $("#ID").val();
			var pw = $("#PW").val();

			if (id == '') {
				alert('Fill ID');
			} else if (pw == '') {
				alert('Fill PW');
			} else {
				firebase.auth().setPersistence(firebase.auth.Auth.Persistence.NONE)
					.then(function() {
						firebase.auth().signInWithEmailAndPassword(id, pw)
							.then(function(user) {
								location.href = "admin.html";
							})
							.catch(function(error) {
								var errorCode = error.code;
								var errorMsg = error.message;

								if (errorCode === 'auth/user-not-found') {
									alert('No such user.');
								} else if (errorCode === 'auth/wrong-password') {
									alert('Wrong password.');
								} else {
									alert(errorMsg);
								}
								console.log(error);
							});
					}).catch(function(error) {
						var errorCode = error.code;
						var errorMsg = error.message;
						console.log(errorMsg);
						alert('Something went wrong while configuring authentication system');
					});
			}
		}

		function init() {
			$('#already').hide();
			firebase.auth().onAuthStateChanged(function(user) {
				if (user) {
					$('#already').show();
					$('#login').attr('disabled', true);
					location.href = 'admin.html';
				} else {
					$('#already').hide();
					$('#login').attr('disabled', false);
				}
			});
		}

		$(document).ready(function() {
			init();
		});
	</script>
</head>

<body>
	<form align=center id="form" class="form" method="post">
		<image src="https://www.pngarts.com/files/4/Coin-PNG-Picture.png" width=200 />
		<p />
		<table border=1 bordercolor=black align=center>
			<tr>
				<td>ID</td>
				<td>
					<input type="text" name="ID" id="ID" />
				</td>
			</tr>
			<tr>
				<td>PW</td>
				<td>
					<input type="password" name="PW" id="PW" />
				</td>
			</tr>
		</table>
		<p />
		<input type="button" name="login" id="login" value="Login" onclick="signIn()" />
	</form>
	<p id="already">You've already logged in. You will be redirected to the admin page soon.</p>
</body>

</html>
